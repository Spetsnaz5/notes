# 目錄

- [MySQL 交易隔離級別 (Transaction Isolation Level)](#mysql-交易隔離級別-transaction-isolation-level)
- [MySQL 鎖機制 (Locking)](#mysql-鎖機制-locking)

---

# MySQL 交易隔離級別 (Transaction Isolation Level)

## 1. 讀未提交 (Read Uncommitted)
最低的隔離級別，允許讀取其他事務尚未提交的變更，可能導致髒讀 (Dirty Read)。
- **效能**：最高，因為不需要加鎖，不會阻止其他事務。
- **鎖資料**：否。
- **適用場景**：對數據一致性要求極低，追求極致效能的場景 (如簡單的數據分析)。

## 2. 讀已提交 (Read Committed)
保證只能讀取其他事務已提交的數據，避免髒讀，但可能出現不可重複讀 (Non-repeatable Read)。
- **效能**：相對較高，開銷低於更高隔離級別。
- **鎖資料**：部分鎖定。讀取時加共享鎖，修改時加排他鎖。
- **適用場景**：大部分日常應用的理想選擇 (如 OLTP 系統)。

## 3. 可重複讀 (Repeatable Read)
保證同一事務內多次讀取相同數據的結果一致，避免髒讀與不可重複讀。MySQL InnoDB 的默認隔離級別。
- **效能**：略低於 `READ COMMITTED`，因為需要維持一致性快照，並可能使用間隙鎖 (Gap Lock) 來防止幻讀 (Phantom Read)。
- **鎖資料**：是。讀取時加共享鎖和間隙鎖，寫入時加排他鎖。
- **適用場景**：MySQL 預設選擇，適合需要數據一致性但又需要一定性能的場景。

## 4. 可序列化 (Serializable)
最高的隔離級別，通過強制事務順序執行，完全避免所有併發問題，但會大幅降低並發性能。
- **效能**：最差，因為所有操作都會被序列化。
- **鎖資料**：是。讀寫都會鎖定範圍內的所有數據。
- **適用場景**：需要強一致性的極端場景 (如金融系統)。

### 隔離級別綜合比較

| 隔離級別         | 效能 | 是否鎖資料           | 特點                                       |
| ------------------ | ---- | ---------------------- | ------------------------------------------ |
| READ UNCOMMITTED   | 最高 | 不鎖資料               | 無一致性保證，適合快速讀取需求。           |
| READ COMMITTED     | 高   | 部分鎖資料             | 避免脏讀，適合大多數應用場景。             |
| REPEATABLE READ    | 中   | 會鎖資料（含間隙鎖）   | 避免脏讀與不可重複讀，是 MySQL 默認選擇。 |
| SERIALIZABLE       | 低   | 會鎖資料（讀寫都鎖）   | 強一致性，但效能低，僅適用於特殊場景。     |

> **參考資料**: [Transaction 併發錯誤與隔離層級](https://oldmo860617.medium.com/transaction-%E4%BD%B5%E7%99%BC%E9%8C%AF%E8%AA%A4%E8%88%87%E9%9A%94%E9%9B%A2%E5%B1%A4%E7%B4%9A-51b8af6178ae)

---

# MySQL 鎖機制 (Locking)

## 主要鎖類型

| 鎖類型       | 用途             | 特點                               |
| ------------ | ---------------- | ---------------------------------- |
| **共享鎖 (S)** | 保護讀取操作     | 允許多事務同時讀取，禁止寫入       |
| **排他鎖 (X)** | 保護寫入操作     | 寫操作唯一持有，禁止其他讀/寫      |
| **意向鎖 (IS/IX)** | 多層級鎖協調     | 快速檢查表級鎖是否可加             |

## 特定鎖類型與概念

| 鎖類型         | 用途                 | 特點                                     |
| -------------- | -------------------- | ---------------------------------------- |
| **行級鎖**     | 僅對單行資料加鎖     | 粒度小，並發性能高                       |
| **表級鎖**     | 對整個表加鎖         | 粒度大，適合批量操作                     |
| **間隙鎖 (Gap Lock)** | 防止幻讀             | 鎖住索引「間隙」，而非具體行              |
| **Next-Key Lock** | 結合行鎖和間隙鎖     | 鎖住匹配行及其前方間隙                   |
| **悲觀鎖**     | 實時加鎖以避免衝突   | 通常基於資料庫原生鎖 (`SELECT ... FOR UPDATE`) |
| **樂觀鎖**     | 檢查版本號避免衝突   | 不依賴資料庫鎖，應用層實現，效率高       |

---